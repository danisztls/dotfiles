#!/bin/bash
#
# Download any content (videos currently) from the web

# @author: Daniel Souza <me@posix.dev.br>
# @license: MIT
# @usage: get-txt <URL>
# @deps: yt-dlp, openai/whisper
#
# TODO: Rewrite this in Python?

url="$1"

# random ID
# id="$(tr -dc 'a-zA-Z0-9' < /dev/urandom | fold -w 7 | head -n 1)"

# Youtube video ID
id=${url##*v=}

audio_file="/run/user/$(id -u)/$id"

yt-dlp --sponsorblock-remove all --format ba --no-write-subs --output "$audio_file" "$url"

# TODO: Try https://whisperapi.com/
whisper "$audio_file" --model base 2>&1

# remove temporary video file
rm "$audio_file"

# remove undesired formats
rm "$id".srt "$id".vtt
